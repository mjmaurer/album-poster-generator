{% extends "poster/index.html" %}
{% load staticfiles %}

{% block content %}
<div class="container">
	  <!--PAGE TITLE-->

	<div class="row">
		<div class="span12">
		<div class="page-header">
				<h1>
				Contact
			</h1>
		</div>
		</div>
	</div>

  <!-- /. PAGE TITLE-->

  <div class="row">

        <form id="submitPoster" method="post">{% csrf_token %}
          <input type="hidden" name="picUrls" id="picUrls">
          <input type="hidden" name="albumNames" id="albumNames">
          <input type="submit" value="Download the pic!">
        </form>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
        <script src="http://malsup.github.com/jquery.form.js"></script> 
        <script>
            var onSubmit = function() {
              var urlValues = [];
              var albumTitleValues = [];
              $('div[style="display: block;"]').each(function() {
                urlValues.push(this.getElementsByTagName('img')[0].src);
                albumTitleValues.push(this.getElementsByTagName('img')[0].title.replace(/,/g, ''));
              });
              // document.getElementById("picUrls").value = urlValues;
              // document.getElementById("albumNames").value = albumTitleValues;
              console.log(urlValues);
              return {picUrls: urlValues, albumNames: albumTitleValues};
            }
            $("#submitPoster").submit(function() {
              var urlValues = [];
              var albumTitleValues = [];
              $('div[style="display: block;"]').each(function() {
                urlValues.push(this.getElementsByTagName('img')[0].src);
                albumTitleValues.push(this.getElementsByTagName('img')[0].title.replace(/,/g, ''));
              });
              // document.getElementById("picUrls").value = urlValues;
              // document.getElementById("albumNames").value = albumTitleValues;
              console.log(urlValues);
              $(this).ajaxSubmit({
                url: 'pic_stitch',
                data: {picUrls: urlValues, albumNames: albumTitleValues},
                type: 'post',
                    success: function(response, status, xhr) {
                        // check for a filename
                        var filename = "";
                        var disposition = xhr.getResponseHeader('Content-Disposition');
                        if (disposition && disposition.indexOf('attachment') !== -1) {
                            var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                            var matches = filenameRegex.exec(disposition);
                            if (matches != null && matches[1]) filename = matches[1].replace(/['"]/g, '');
                        }

                        var type = xhr.getResponseHeader('Content-Type');
                        var blob = new Blob([response], { type: type });

                        if (typeof window.navigator.msSaveBlob !== 'undefined') {
                            window.navigator.msSaveBlob(blob, filename);
                        } else {
                            var URL = window.URL || window.webkitURL;
                            var downloadUrl = URL.createObjectURL(blob);

                            if (filename) {
                                // use HTML5 a[download] attribute to specify filename
                                var a = document.createElement("a");
                                // safari doesn't support this yet
                                if (typeof a.download === 'undefined') {
                                    window.location = downloadUrl;
                                } else {
                                    a.href = downloadUrl;
                                    a.download = filename;
                                    document.body.appendChild(a);
                                    a.click();
                                }
                            } else {
                                window.location = downloadUrl;
                            }

                            setTimeout(function () { URL.revokeObjectURL(downloadUrl); }, 100); // cleanup
                        }
                    }})
            })
        </script>
  			<div class="container">
          {% for key, row in artist_rows.items %}
              <div class="row">
              {% for key2, artist in row.items %}
              <div class="{{ span_sized }} nopadding" id="pic{{ forloop.parentloop.counter }}{{ forloop.parentloop.parentloop.counter }}" style="position:relative;">
                   

                          {% for name, pic_source in artist.items %}

                          <div class="slide{{ forloop.parentloop.counter }}{{ forloop.parentloop.parentloop.counter }}">
                            <img class="img-responsive" title="{{ name }}" src="{{ pic_source }}">
                          </div>

                          {% endfor %}

                          {% if artist|length > 1 %}
                              <img src="{% static 'poster/img/left.png' %}" class="arrow" style="top:45%;left:0" onclick="plusDivs{{ forloop.counter }}{{ forloop.parentloop.counter }}(-1)"></img>
                              <img src="{% static 'poster/img/right.png' %}" class="arrow" style="top:45%;right:0" onclick="plusDivs{{ forloop.counter }}{{ forloop.parentloop.counter }}(1)"></img>
                          {% endif %}

              </div>
              {% endfor %}
              </div>
          {% endfor %}
            <!-- <div class="row">
              <div class="span6 nopadding" style="position:relative;">
                   
                      <div class="mySlides" data-tooltip="#as">
                        <img class="img-responsive" title="1" src="https://i.scdn.co/image/5f8349e8e4ed81b48f033a9818939c835520f150">
                      </div>

                      <div class="mySlides" data-tooltip="#asf">
                        <img class="img-responsive"  title="2"  src="https://i.scdn.co/image/f8717f432506ab213c4de0c66d6ac24cd07ecf72">
                      </div>


                      <img src="{% static 'poster/img/left.png' %}" class="arrow" style="top:45%;left:0" onclick="plusDivs(-1)"></img>
                      <img src="{% static 'poster/img/right.png' %}" class="arrow" style="top:45%;right:0" onclick="plusDivs(1)"></img>
              </div>

              <div class="span6 nopadding" style="position:relative;">
                   
                      <div class="mySlides2" data-tooltip="#as">
                        <img class="img-responsive" title="1" src="https://i.scdn.co/image/5f8349e8e4ed81b48f033a9818939c835520f150">
                      </div>

                      <div class="mySlides2" data-tooltip="#asf">
                        <img class="img-responsive"  title="2"  src="https://i.scdn.co/image/f8717f432506ab213c4de0c66d6ac24cd07ecf72">
                      </div>


                      <img src="{% static 'poster/img/left.png' %}" class="arrow" style="top:45%;left:0" onclick="plusDivs2(-1)"></img>
                      <img src="{% static 'poster/img/right.png' %}" class="arrow" style="top:45%;right:0" onclick="plusDivs2(1)"></img>
              </div>
              
            </div> -->
                    

                      <script>

                      {% for key, row in artist_rows.items %}
                   
                        {% for key2, artist in row.items %}
                            var slideIndex{{ forloop.counter }}{{ forloop.parentloop.counter }} = 1;
                            showDivs{{ forloop.counter }}{{ forloop.parentloop.counter }}(slideIndex{{ forloop.counter }}{{ forloop.parentloop.counter }});

                            function plusDivs{{ forloop.counter }}{{ forloop.parentloop.counter }}(n) {
                              showDivs{{ forloop.counter }}{{ forloop.parentloop.counter }}(slideIndex{{ forloop.counter }}{{ forloop.parentloop.counter }} += n);
                            }

                            function showDivs{{ forloop.counter }}{{ forloop.parentloop.counter }}(n) {
                              var i;
                              var x = document.getElementsByClassName("slide{{ forloop.counter }}{{ forloop.parentloop.counter }}");
                              if (n > x.length) {slideIndex{{ forloop.counter }}{{ forloop.parentloop.counter }} = 1}    
                              if (n < 1) {slideIndex{{ forloop.counter }}{{ forloop.parentloop.counter }} = x.length} ;
                              for (i = 0; i < x.length; i++) {
                                 x[i].style.display = "none";  
                              }
                              x[slideIndex{{ forloop.counter }}{{ forloop.parentloop.counter }}-1].style.display = "block";  
                            }
                          {% endfor %}
                        {% endfor %}
                      </script>
        </div>
  </div>

</div>
{% endblock %}
